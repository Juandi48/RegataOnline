<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Juego · Regata Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/dashboard.html">🏁 Regata Online</a>
    <div class="ms-auto d-flex gap-2">
      <a class="btn btn-secondary" href="/dashboard.html">Ver Stats</a>
      <a class="btn btn-danger" href="/dashboard.html">Abandonar</a>
    </div>
  </div>
</nav>

<div class="container my-4">
  <div class="card">
    <div class="card-header text-center">Carrera en Curso</div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <div id="grid" class="grid"></div>
        </div>
        <div class="col-md-8">
          <div class="p-4 bg-light rounded h-100 d-flex align-items-center justify-content-center">
            <h5 id="turnoTxt">Turno de: - | Turno 0</h5>
          </div>
        </div>
      </div>
      <hr>
      <div class="text-center">
        <div class="mb-2">Velocidad actual: <span id="vel">(0,0)</span></div>
        <div class="d-flex flex-wrap justify-content-center gap-2">
          <button class="btn btn-secondary" onclick="mov(-1,+1)">↖ (-1,+1)</button>
          <button class="btn btn-secondary" onclick="mov(0,+1)">↑ (0,+1)</button>
          <button class="btn btn-secondary" onclick="mov(+1,+1)">↗ (+1,+1)</button>
          <button class="btn btn-secondary" onclick="mov(-1,0)">← (-1,0)</button>
          <button class="btn btn-success"   onclick="mov(0,0)">• (0,0)</button>
          <button class="btn btn-secondary" onclick="mov(+1,0)">→ (+1,0)</button>
          <button class="btn btn-secondary" onclick="mov(-1,-1)">↙ (-1,-1)</button>
          <button class="btn btn-secondary" onclick="mov(0,-1)">↓ (0,-1)</button>
          <button class="btn btn-secondary" onclick="mov(+1,-1)">↘ (+1,-1)</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
const APIv1="/api/v1";
let estado=null;

function drawGrid(mapa, barco){
  const cont=document.getElementById('grid');
  cont.style.setProperty('--w', mapa.ancho);
  cont.innerHTML='';
  const tipos = new Map(mapa.celdas.map(c => [`${c.x},${c.y}`, c.tipo]));
  for(let y=0;y<mapa.alto;y++){
    for(let x=0;x<mapa.ancho;x++){
      const d=document.createElement('div');
      const t=(tipos.get(`${x},${y}`)||'PARED').toLowerCase();
      d.className='cell cell-'+t;
      if(barco && barco.posX===x && barco.posY===y) d.classList.add('cell-barco');
      cont.appendChild(d);
    }
  }
}
async function start(){
  estado = await fetch(`${APIv1}/game/start?mapaId=1&barcoId=1`,{method:'POST'}).then(r=>r.json());
  render();
}
async function mov(dx,dy){
  estado = await fetch(`${APIv1}/game/move`,{
    method:'POST',headers:{'Content-Type':'application/json'},
    body: JSON.stringify({deltaVX:dx, deltaVY:dy})
  }).then(r=>r.json());
  render();
}
function render(){
  document.getElementById('turnoTxt').textContent = `Turno de: ${estado.jugador?.nombre||'Jugador'} | Turno ${estado.turno||0}`;
  document.getElementById('vel').textContent = `(${estado.barco?.velX||0},${estado.barco?.velY||0})`;
  drawGrid(estado.mapa, estado.barco);
}
start();
</script>
</body>
</html>

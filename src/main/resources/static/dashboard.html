<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Dashboard · Regata Online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/dashboard.html">🏁 Regata Online</a>
    <div class="ms-auto">
      <a class="btn btn-secondary" href="/login.html">Cerrar Sesión</a>
    </div>
  </div>
</nav>

<div class="container my-4">
  <h5 class="mb-3">Dashboard Jugador</h5>
  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-body">
          <div class="row text-center g-3">
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <div class="fs-3 fw-bold" id="cntJug">0</div>
                <div>Jugadores</div>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <div class="fs-3 fw-bold" id="cntBar">0</div>
                <div>Barcos</div>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <div class="fs-3 fw-bold" id="cntMod">0</div>
                <div>Modelos</div>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-light rounded">
                <div class="fs-3 fw-bold" id="cntCarr">1</div>
                <div>Carreras Activas</div>
              </div>
            </div>
          </div>
          <hr>
          <div class="d-grid gap-2">
            <a class="btn btn-secondary" href="/jugadores.html">👤 Gestionar Jugadores</a>
            <a class="btn btn-secondary" href="/barcos.html">🚤 Gestionar Barcos</a>
            <a class="btn btn-secondary" href="/modelos.html">🧩 Gestionar Modelos</a>
            <a class="btn btn-secondary" href="/mapas.html">🗺️ Gestionar Mapas</a>
            <a class="btn btn-primary" href="/juego.html">🎮 Ir al Juego</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Gestión rápida (vista de tabla) -->
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-header">Gestión de Jugadores</div>
        <div class="card-body">
          <div class="d-flex justify-content-between mb-2">
            <a class="btn btn-success" href="/jugadores.html#nuevo">+ Nuevo Jugador</a>
            <a class="btn btn-secondary" href="/dashboard.html">Dashboard</a>
          </div>
          <input class="form-control mb-2" placeholder="Buscar jugador...">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead><tr><th>ID</th><th>Nombre</th><th>Email</th><th>Barcos</th><th>Acciones</th></tr></thead>
              <tbody id="tblJug"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Crear/Editar -->
    <div class="col-lg-4">
      <div class="card h-100">
        <div class="card-header">Crear/Editar Jugador</div>
        <div class="card-body">
          <div class="mb-2">
            <label class="form-label">Nombre Completo</label>
            <input id="jNombre" class="form-control">
          </div>
          <div class="mb-2">
            <label class="form-label">Email</label>
            <input id="jEmail" class="form-control">
          </div>
          <div class="d-flex gap-2">
            <button id="btnGuardarJug" class="btn btn-success">💾 Guardar</button>
            <a class="btn btn-danger" href="/dashboard.html">✖ Cancelar</a>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
const API="/api";
const APIv1="/api/v1";

async function j(url,opt){const r=await fetch(url,opt);return r.json();}

(async ()=>{
  const [jug, bar, mod] = await Promise.all([
    j(`${API}/jugadores`),
    j(`${API}/barcos`),
    j(`${API}/modelos-barcos`)
  ]);
  document.getElementById('cntJug').textContent = jug.length;
  document.getElementById('cntBar').textContent = bar.length;
  document.getElementById('cntMod').textContent = mod.length;

  const tb=document.getElementById('tblJug');
  tb.innerHTML = jug.map((u,i)=>`
    <tr>
      <td>${u.id||i+1}</td>
      <td>${u.nombre||'-'}</td>
      <td>${u.email||'-'}</td>
      <td>-</td>
      <td>
        <a class="btn btn-sm btn-info" href="/jugadores.html#ver-${u.id}">Ver</a>
        <a class="btn btn-sm btn-warning" href="/jugadores.html#edit-${u.id}">Editar</a>
        <button class="btn btn-sm btn-danger" onclick="delJug(${u.id})">Eliminar</button>
      </td>
    </tr>
  `).join('');
})();

async function delJug(id){
  if(!confirm('¿Eliminar jugador?')) return;
  await fetch(`${API}/jugadores/${id}`,{method:'DELETE'});
  location.reload();
}

document.getElementById('btnGuardarJug').onclick = async ()=>{
  const body = { nombre: document.getElementById('jNombre').value, email: document.getElementById('jEmail').value };
  await fetch(`${API}/jugadores`,{ method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
  location.reload();
};
</script>
</body>
</html>

<div class="container my-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>Gesti贸n de Barcos</h5>
    <a class="btn btn-secondary" routerLink="/dashboard">Dashboard</a>
  </div>

  @if (errorMsg(); as msg) {
    <div class="alert alert-danger">
      {{ msg }}
    </div>
  }

  <!-- Filtros y creaci贸n de barcos -->
  <div class="d-flex flex-wrap align-items-end gap-3 mb-4">

    <!-- ADMIN: selector de jugadores -->
    @if (isAdmin()) {
      <div class="flex-grow-1">
        <label class="form-label fw-semibold">Jugador</label>
        <select class="form-select" [(ngModel)]="selectedJugadorIdModel">
          <option [ngValue]="null">Todos los jugadores</option>

          @for (j of jugadores(); track j.id) {
            <option [ngValue]="j.id">
              {{ j.nombre }}
            </option>
          }
        </select>
      </div>
    }

    <!-- JUGADOR: muestra su nombre -->
    @if (isJugador()) {
      <div class="flex-grow-1">
        <label class="form-label fw-semibold d-block">Jugador</label>
        <div class="form-control-plaintext">
          {{ auth.currentUser()?.nombre }}
          <small class="text-muted">(solo puedes crear tu propio barco)</small>
        </div>
      </div>
    }

    <!-- MODELOS (ambos roles) -->
    <div class="flex-grow-1">
      <label class="form-label fw-semibold">Modelo</label>
      <select class="form-select" [(ngModel)]="selectedModeloIdModel">
        <option [ngValue]="null">Todos los modelos</option>

        @for (m of modelos(); track m.id) {
          <option [ngValue]="m.id">
            {{ m.nombre }}
          </option>
        }
      </select>
    </div>

    <!-- Bot贸n crear barco -->
    <div>
      <button class="btn btn-success" (click)="nuevo()">
        + Nuevo Barco
      </button>
    </div>

  </div>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>ID</th>
          <th>Modelo</th>
          <th>Propietario</th>
          <th>Posici贸n</th>
          <th>Velocidad</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>

        @for (b of barcos(); track b.id) {
          <tr>
            <td>{{ b.id }}</td>
            <td>{{ b.nombreModelo }}</td>
            <td>{{ b.nombreJugador }}</td>
            <td>({{ b.posX }}, {{ b.posY }})</td>
            <td>({{ b.velX }}, {{ b.velY }})</td>
            <td>
              <button
                class="btn btn-sm btn-danger"
                (click)="eliminar(b.id)"
                [disabled]="isJugador()">
                Eliminar
              </button>
            </td>
          </tr>
        }

        @if (barcos().length === 0) {
          <tr>
            <td colspan="6" class="text-center text-muted py-3">
              No hay barcos registrados.
            </td>
          </tr>
        }

      </tbody>
    </table>
  </div>

</div>
